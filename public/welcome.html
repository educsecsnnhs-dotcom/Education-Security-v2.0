<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Welcome - EDU-SEC</title>
  <!-- âœ… Only load welcome-specific CSS -->
  <link rel="stylesheet" href="css/welcome.css">

  <!-- Scripts -->
  <script defer src="js/auth.js"></script>
  <script defer src="js/script.js"></script>
  <script defer src="js/menu.js"></script>
  <script defer src="js/welcome.js"></script>
</head>
<body>
  <!-- Sidebar -->
  <nav class="sidebar">
    <ul id="menuList"></ul>
  </nav>

  <!-- Header -->
  <header>
    <h1 class="title">SNNHS SCHOOL PORTAL</h1>
    <div id="clock"></div>
    <button id="logoutBtn" class="logout">Logout</button>
  </header>

  <!-- Main Content -->
  <main>
    <!-- User Info -->
    <section class="user-info">
      <h2>ğŸ‘‹ Welcome, <span id="userName">User</span></h2>
      <p>Role: <strong id="userRole">Role</strong></p>
      <p id="todayDate"></p>
    </section>

    <!-- Announcements -->
    <section class="card">
      <h2>ğŸ“Œ School-wide Announcements</h2>
      <div id="schoolAnnouncements" class="announcement-list">
        <!-- Filled dynamically -->
      </div>
    </section>

    <!-- School Info -->
    <section class="card">
      <h2>ğŸ« School Info</h2>
      <div class="pdf-viewer">
        <embed src="school-info.pdf" type="application/pdf" />
      </div>
    </section>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      try {
        const res = await fetch("/api/auth/me", { credentials: "include" });
        if (!res.ok) {
          window.location.href = "login.html";
          return;
        }
        const { user } = await res.json();

        document.getElementById("userName").textContent = user.email;
        document.getElementById("userRole").textContent = user.role;
      } catch (err) {
        console.error("Session check failed:", err);
        window.location.href = "login.html";
      }

      function updateClock() {
        const now = new Date();
        const optionsTime = { hour12: false, timeZone: "Asia/Manila" };
        const optionsDate = {
          weekday: "long",
          year: "numeric",
          month: "long",
          day: "numeric",
          timeZone: "Asia/Manila"
        };

        document.getElementById("clock").textContent =
          now.toLocaleTimeString("en-PH", optionsTime);
        document.getElementById("todayDate").textContent =
          "Today is " + now.toLocaleDateString("en-PH", optionsDate);
      }
      setInterval(updateClock, 1000);
      updateClock();

      document.getElementById("logoutBtn").addEventListener("click", async () => {
        await fetch("/api/auth/logout", { method: "POST", credentials: "include" });
        window.location.href = "login.html";
      });
    });
  </script>
</body>
</html>
