<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Welcome - EDU-SEC</title>
  <link rel="stylesheet" href="/styles.css">

  <!-- Scripts -->
  <script defer src="js/auth.js"></script>
  <script defer src="js/script.js"></script>
  <script defer src="js/menu.js"></script>
  <script defer src="js/welcome.js"></script>
</head>
<body>
  <!-- Top bar -->
  <header>
    <h1 class="title">SNNHS SCHOOL PORTAL</h1>
    <div class="clock" id="clock">--:--:--</div>
    <button id="logoutBtn" class="logout">Logout</button>
  </header>

  <!-- Sidebar -->
  <nav class="sidebar" id="sidebar">
    <ul id="menuList"></ul>
  </nav>

  <!-- Main Content -->
  <main>
    <!-- User Info -->
    <section class="user-info">
      <h2>👋 Welcome, <span id="userName">User</span></h2>
      <p>Role: <strong id="userRole">Role</strong></p>
      <p id="todayDate"></p>
    </section>

    <!-- Announcements -->
    <section class="card">
      <h2>📌 School-wide Announcements</h2>
      <div id="schoolAnnouncements" class="announcement-list">
        <!-- Filled dynamically -->
      </div>
    </section>

    <!-- School Info -->
    <section class="card">
      <h2>🏫 School Info</h2>
      <div class="pdf-viewer">
        <embed src="school-info.pdf" type="application/pdf" width="100%" height="500px" />
      </div>
    </section>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      // ✅ Check session and fetch user
      try {
        const res = await fetch("/api/auth/me", { credentials: "include" });
        if (!res.ok) {
          window.location.href = "login.html"; // not logged in
          return;
        }
        const user = await res.json();

        // ✅ Fill UI with session data
        document.getElementById("userName").textContent = user.username;
        document.getElementById("userRole").textContent = user.role;
      } catch (err) {
        console.error("Session check failed:", err);
        window.location.href = "login.html";
      }

      // Live Clock + Date (Philippines Timezone)
      function updateClock() {
        const now = new Date();
        const optionsTime = { hour12: false, timeZone: "Asia/Manila" };
        const optionsDate = { weekday: "long", year: "numeric", month: "long", day: "numeric", timeZone: "Asia/Manila" };

        document.getElementById("clock").textContent =
          now.toLocaleTimeString("en-PH", optionsTime);
        document.getElementById("todayDate").textContent =
          "Today is " + now.toLocaleDateString("en-PH", optionsDate);
      }
      setInterval(updateClock, 1000);
      updateClock();

      // ✅ Logout button
      document.getElementById("logoutBtn").addEventListener("click", async () => {
        await fetch("/api/auth/logout", { method: "POST", credentials: "include" });
        window.location.href = "login.html";
      });
    });
  </script>
</body>
</html>
